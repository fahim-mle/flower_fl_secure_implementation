services:
  superlink:
    build:
      context: ./superlink
      dockerfile: Dockerfile
    container_name: superlink
    environment:
      SUPERLINK_HOST: "0.0.0.0"
      SUPERLINK_PORT: "9091"
      SUPERLINK_ROUNDS: "3"
    networks:
      - fl_internal_net
    volumes:
      - ./superlink/config:/app/config:ro
      - superlink_certs:/etc/flwr/certs
    restart: unless-stopped

  supernode-1:
    build:
      context: ./supernode
      dockerfile: Dockerfile
    container_name: supernode-1
    environment:
      SUPERLINK_ADDRESS: "superlink:9091"
      CLIENT_ID: "supernode-1"
    depends_on:
      - superlink
    networks:
      - fl_internal_net
    volumes:
      - ./supernode/config:/app/config:ro
      - supernode1_data:/data
      - supernode1_certs:/etc/flwr/certs
    restart: unless-stopped

  supernode-2:
    build:
      context: ./supernode
      dockerfile: Dockerfile
    container_name: supernode-2
    environment:
      SUPERLINK_ADDRESS: "superlink:9091"
      CLIENT_ID: "supernode-2"
    depends_on:
      - superlink
    networks:
      - fl_internal_net
    volumes:
      - ./supernode/config:/app/config:ro
      - supernode2_data:/data
      - supernode2_certs:/etc/flwr/certs
    restart: unless-stopped

networks:
  fl_internal_net:
    driver: bridge
  fl_reverse_proxy_net:
    driver: bridge

volumes:
  fl_ca_certs:
  superlink_certs:
  supernode1_data:
  supernode1_certs:
  supernode2_data:
  supernode2_certs:
